{% block stylesheets %}
    {% if not (app.request.isXmlHttpRequest() or app.request.query.getBoolean('partial')) %}
        {{ parent() }}
        <link rel="stylesheet" href="{{ asset('assets/css/serie-watch-links.css') }}?v={{ 'now'|date('U') }}">
    {% endif %}
{% endblock %}

<div class="serie-watch-links">
    {% if watchLinks is not empty %}
        {% for p in watchLinks %}
            {% set key = (p.provider ?? p.key ?? p.label)|lower|replace({' ':'','+':'','.':''}) %}
            {% set iconPath = p.icon starts with('http') ? p.icon : asset(p.icon) %}
            <a href="{{ p.url }}" class="serie-watch-chip is-{{ key }}" target="_blank" rel="noopener">
                <img src="{{ iconPath }}" alt="{{ p.label }}">
                {{ p.label }}
            </a>
        {% endfor %}
    {% else %}
        <span class="text-muted">Aucun lien de streaming disponible.</span>
    {% endif %}
</div>

{% if is_granted('ROLE_ADMIN') %}
    <div class="d-flex justify-content-end mt-2">
        <button type="button" class="btn-add-link" data-bs-toggle="modal" data-bs-target="#addLinkModal">
            âž• Ajouter un lien
        </button>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="addLinkModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title">Ajouter un lien de streaming</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    {{ form_start(linkForm, {
                        action: path('serie_link_add', { id: serie.id }),
                        method: 'POST',
                        attr: { class: 'needs-validation', novalidate: 'novalidate' }
                    }) }}

                    {{ form_row(linkForm.provider) }}
                    {{ form_row(linkForm.url) }}
                    {{ form_row(linkForm.enabled) }}

                    <div class="d-flex justify-content-end gap-2 mt-2">
                        <button type="button" class="btn-ghost-teal" data-bs-dismiss="modal">Annuler</button>
                        <button type="submit" class="btn-add-link">Ajouter</button>
                    </div>

                    {{ form_end(linkForm) }}
                </div>
            </div>
        </div>
    </div>
{% endif %}
