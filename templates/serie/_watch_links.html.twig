<div class="watch-list">
    {% if watchLinks is not empty %}
        {% for p in watchLinks %}
            {% set key = (p.provider ?? p.key ?? p.label)|lower|replace({' ':'','+':'','.':''}) %}
            {% set iconPath = p.icon starts with('http') ? p.icon : asset(p.icon) %}
            <a href="{{ p.url }}" class="watch-chip watch-chip--lg is-{{ key }}" target="_blank" rel="noopener">
                <img src="{{ iconPath }}" alt="{{ p.label }}">
                {{ p.label }}
            </a>
        {% endfor %}
    {% else %}
        <span class="text-muted">Aucun lien de streaming disponible.</span>
    {% endif %}
</div>

{% if is_granted('ROLE_ADMIN') %}
    {% set rawLinks = serie.streamingLinks ?? [] %}
    <div class="watch-admin">
        <strong>Gestion des liens</strong>
        {% if rawLinks %}
            <ul class="watch-admin-list">
                {% for link in rawLinks %}
                    <li class="d-flex align-items-center gap-2">
                        <code>{{ link.provider|default('') }}</code>
                        {% if link.enabled %}<span class="badge bg-success">actif</span>{% else %}<span class="badge bg-secondary">inactif</span>{% endif %}
                        <form method="post"
                              action="{{ path('serie_link_delete', { id: serie.id, index: loop.index0 }) }}"
                              data-link-delete
                              class="ms-auto">
                            <input type="hidden" name="_token" value="{{ csrf_token('del_link_' ~ serie.id ~ '_' ~ loop.index0) }}">
                            <button type="submit" class="btn btn-outline-teal btn-sm">Supprimer</button>
                        </form>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <em class="text-muted d-block mt-1">Aucun lien enregistr√©.</em>
        {% endif %}
    </div>
{% endif %}
