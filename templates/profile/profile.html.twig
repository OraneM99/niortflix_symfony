{% extends 'base.html.twig' %}

{% block title %}Mon profil{% endblock %}

{% block body %}
    <div class="container-fluid p-0">
        <div class="row m-0">
            {% include 'profile/_sidebar.html.twig' %}

            <!-- Aligne le contenu en haut, à côté de la sidebar -->
            <main class="col-md-9 col-lg-10 px-4 d-flex align-items-start justify-content-center">

                <div class="card bg-dark border-0 shadow-lg w-100" style="max-width: 980px;">
                    <!-- Bandeau -->
                    <div class="profile-banner"></div>

                    <!-- En-tête noir : avatar + infos + bouton -->
                    <div class="profile-header d-flex justify-content-between align-items-center px-4 py-3">
                        <div class="d-flex align-items-center gap-3">
                            <!-- avatar cliquable avec overlay “Modifier” -->
                            <a href="{{ path('profile_edit') }}"
                               class="avatar-wrap position-relative d-inline-block"
                               aria-label="Modifier la photo de profil">
                                {% set avatar = app.user.profilePicture ? asset('uploads/profile_pictures/' ~ app.user.profilePicture) : asset('images/default-avatar.png') %}
                                <img src="{{ avatar }}" alt="Photo de profil" class="rounded-circle profile-avatar shadow-sm">
                                <span class="avatar-overlay">Modifier</span>
                                <span class="status-dot"></span>
                            </a>

                            <div class="text-white">
                                <div class="fs-4 fw-bold">
                                    {{ app.user.displayName ?? app.user.username }}
                                </div>
                            </div>
                        </div>

                        <a href="{{ path('profile_edit') }}" class="btn btn-primary btn-edit">
                            Modifier profil d'utilisateur
                        </a>
                    </div>

                    <!-- Bloc “Profil” -->
                    <div class="px-4 py-4">
                        <div class="section-title">Profil</div>

                        <div class="setting-row">
                            <div>
                                <div class="setting-label">Nom d'utilisateur</div>
                                <div class="setting-value">{{ app.user.username }}</div>
                            </div>
                            <a href="{{ path('profile_edit') }}" class="btn btn-secondary">Modifier</a>
                        </div>

                        <div class="setting-row border-0">
                            <div>
                                <div class="setting-label">E-mail</div>
                                <div class="setting-value">{{ app.user.email }}</div>
                            </div>
                            <a href="{{ path('profile_edit') }}" class="btn btn-secondary">Modifier</a>
                        </div>
                    </div>

                    <hr class="m-0 border-secondary">

                    <!-- Bloc “Mot de passe et authentification” -->
                    <div class="px-4 py-4">
                        <div class="section-title">Mot de passe et authentification</div>
                        <a href="{{ path('profile_edit') }}" class="btn btn-primary">Changer le mot de passe</a>
                    </div>

                    <hr class="m-0 border-secondary">

                    <!-- Bloc “Suppression du compte” -->
                    <div class="px-4 py-4">
                        <div class="section-title">Suppression du compte</div>
                        <p class="text-white-50 small mb-3">
                            Désactiver ton compte signifie que tu pourras le récupérer à tout moment après sa désactivation.
                        </p>

                        <div class="d-flex flex-wrap gap-2">
                            <!-- Désactivation -->
                            <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#modalDeactivate">
                                Désactiver le compte
                            </button>
                            <!-- Suppression définitive -->
                            <button class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#modalDelete">
                                Supprimer le compte
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal fade" id="modalDeactivate" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark text-white border-secondary">
                <div class="modal-header border-0">
                    <h5 class="modal-title">Désactiver le compte</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fermer"></button>
                </div>
                <div class="modal-body">
                    Es-tu sûr de vouloir désactiver ton compte ? Tu pourras le réactiver plus tard.
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <a href="{{ path('profile_desactive') }}" class="btn btn-danger">Oui, désactiver</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalDelete" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark text-white border-secondary">
                <div class="modal-header border-0">
                    <h5 class="modal-title">Supprimer le compte</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fermer"></button>
                </div>
                <div class="modal-body">
                    Cette action est <strong>définitive</strong>. Toutes tes données seront supprimées.
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <a href="{{ path('profile_delete') }}" class="btn btn-outline-danger">Oui, supprimer</a>
                </div>
            </div>
        </div>
    </div>

    <style>
        body, html{ background:#121212; color:#fff; }

        /* Bandeau bleu */
        .profile-banner{
            height: 140px;
            background: linear-gradient(180deg,#8AABC7,#86A4C0);
            border-top-left-radius: .5rem;
            border-top-right-radius: .5rem;
        }

        /* Header noir */
        .profile-header{
            background:#0f0f10;
            border-bottom:1px solid #202225;
        }

        /* Avatar (plus grand) */
        .profile-avatar{
            width: 110px;               /* ↑ taille */
            height: 110px;
            object-fit: cover;
            border: 5px solid #0f0f10;  /* anneau foncé */
            border-radius: 50%;
        }
        .avatar-wrap{ margin-top: -55px; } /* chevauche le bandeau */
        .status-dot{
            position:absolute; right:8px; bottom:8px;
            width:16px; height:16px; border-radius:50%;
            background:#2dc770; border:2px solid #0f0f10;
        }
        /* overlay “Modifier” au survol */
        .avatar-overlay{
            position:absolute; inset:0;
            display:flex; align-items:center; justify-content:center;
            background: rgba(0,0,0,.45);
            color:#fff; font-weight:700; font-size:.9rem;
            border-radius:50%;
            opacity:0; transition: opacity .18s ease-in-out;
            text-decoration:none;
        }
        .avatar-wrap:hover .avatar-overlay{ opacity:1; }

        /* Boutons un peu plus grands */
        .btn-primary, .btn-secondary, .btn-danger, .btn-outline-danger {
            padding: .7rem 1.15rem;     /* ↑ padding */
            font-size: .95rem;          /* ↑ taille texte */
            border-radius: 10px;
        }
        .btn-edit{ background:#7F8CAA; border:none; }
        .btn-edit:hover{ background:#739EC9; }

        .btn-primary{ background:#7F8CAA; border:none; }
        .btn-primary:hover{ background:#739EC9; }
        .btn-secondary{ background:#2b2b2b; color:#fff; border:none; }
        .btn-secondary:hover{ background:#3a3a3a; }

        .section-title{
            font-weight:700;
            margin-bottom: 1rem;
            font-size: 1.25rem;
            color: white;
        }

        .setting-row{
            padding: 1rem 0;
            border-bottom:1px solid #2a2a2a;
            display:flex; align-items:center; justify-content:space-between;
        }
        .setting-row a.btn{ min-width: 140px; text-align:center; } /* bouton “Modifier” plus large */
        .setting-label{ color:#b9bbbe; font-size:.95rem; }
        .setting-value{ color:#fff; }

        hr{ border-color:#333; }
    </style>
{% endblock %}
